#!/bin/sh
TEMP_DIR=$(mktemp -d)

unset LD_LIBRARY_PATH
export PATH="$TEMP_DIR/bin:$PATH"
export CFLAGS="-fPIC"
export LDFLAGS="-L$TEMP_DIR/lib" # -L/usr/lib/x86_64-linux-gnu"
export PKG_CONFIG_PATH="$TEMP_DIR/lib/pkgconfig" #:/usr/lib/x86_64-linux-gnu/pkgconfig"
export PYTHONPATH="$TEMP_DIR/xcbgen/usr/lib/python2.7/dist-packages"

build() {
    cd "$TEMP_DIR/$1"
    ./configure --prefix=$TEMP_DIR
    make
    make install
}

build_static() {
    cd "$TEMP_DIR/$1"
    ./configure --enable-shared=no --prefix=$TEMP_DIR
    make
    make install
}

# download
cd $TEMP_DIR
mkdir polybar && curl -L "https://github.com/polybar/polybar/releases/download/3.4.3/polybar-3.4.3.tar" | tar -x --strip-components=1 -C polybar
mkdir bin && curl -L "https://github.com/Kitware/CMake/releases/download/v3.18.1/cmake-3.18.1-Linux-x86_64.tar.gz" | tar -xz --strip-components=1
mkdir alsa && curl -L "https://www.alsa-project.org/files/pub/lib/alsa-lib-1.1.3.tar.bz2" | tar -xj --strip-components=1 -C alsa
mkdir xcb-proto && curl -L "https://xcb.freedesktop.org/dist/xcb-proto-1.13.tar.bz2" | tar -xj --strip-components=1 -C xcb-proto
mkdir libxcb && curl -L "https://xcb.freedesktop.org/dist/libxcb-1.13.tar.bz2" | tar -xj --strip-components=1 -C libxcb
mkdir xcb-util && curl -L "https://xcb.freedesktop.org/dist/xcb-util-0.4.0.tar.bz2" | tar -xj --strip-components=1 -C xcb-util
mkdir xcb-util-image && curl -L "https://xcb.freedesktop.org/dist/xcb-util-image-0.4.0.tar.bz2" | tar -xj --strip-components=1 -C xcb-util-image
mkdir xcb-util-wm && curl -L "https://xcb.freedesktop.org/dist/xcb-util-wm-0.4.1.tar.bz2" | tar -xj --strip-components=1 -C xcb-util-wm
mkdir xcbgen && curl -L "http://ftp.kr.debian.org/debian/pool/main/x/xcb-proto/python-xcbgen_1.13-1_all.deb" -o xcbgen/xcbgen.deb && dpkg -x xcbgen/xcbgen.deb xcbgen && rm xcbgen/xcbgen.deb
mkdir cairo && curl -L "http://cairographics.org/snapshots/cairo-1.15.10.tar.xz" | tar -xJ --strip-components=1 -C cairo

build alsa
build xcb-proto
build libxcb
build xcb-util
build xcb-util-image
build xcb-util-wm
build cairo

cd $TEMP_DIR/polybar
./build.sh -a -I -A
