#!/bin/sh

INSTALL_DIR=/tmp/sjb/local
TEMP_DIR=$(mktemp -d)

# libffi

cd $TEMP_DIR
wget 'https://github.com/libffi/libffi/releases/download/v3.3/libffi-3.3.tar.gz'
tar -xf 'libffi-3.3.tar.gz'
cd 'libffi-3.3'

export CXXFLAGS=' -fPIC'
export CFLAGS=' -fPIC'

./configure --prefix=$INSTALL_DIR --enable-shared
make
make install

# python

cd $TEMP_DIR
git clone -b '3.8' --single-branch --depth 1 'https://github.com/python/cpython'
cd cpython

export PATH=$INSTALL_DIR/bin:$PATH
export LD_LIBRARY_PATH=$INSTALL_DIR/lib:$LD_LIBRARY_PATH
export CFLAGS=-I$INSTALL_DIR/include
export CPPFLAGS="-I$INSTALL_DIR/include" LDFLAGS="-L$INSTALL_DIR/lib"

./configure --prefix=$INSTALL_DIR --enable-shared
make
make install

rm -rf $TEMP_DIR
